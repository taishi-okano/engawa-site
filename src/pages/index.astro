---
//
import { getCollection } from 'astro:content';
const posts = await getCollection('blog');
// Êó•‰ªòÈ†Ü„Å´‰∏¶„Å≥Êõø„Åà
const sortedPosts = posts.sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>engawa ‚Äî Taishi Okano</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Taishi Okano",
    "url": "https://taishiokano.com",
    "nationality": { "@type": "Country", "name": "Japan" },
    "jobTitle": "Product Strategy",
    "knowsAbout": ["AI", "UX", "Technology", "Traditional Japanese Crafts", "Mingei", "Design Philosophy"],
    "description": "Exploring the intersection of AI, UX, and the timeless wisdom of Japanese crafts."
  }
  </script>

  <style>
    :root {
      --bg: #F5F0E8;
      --sumi: #1C1917;
      --text: #3D3935;
      --kakishibu: #D4976C;
      --line: rgba(28, 25, 23, 0.08);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 16px; scroll-behavior: smooth; }
    ::selection { background: var(--sumi); color: var(--bg); }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
      min-height: 200vh;
    }

    .hero {
      height: 100vh;
      display: flex;
      flex-direction: column;
      position: sticky;
      top: 0;
      overflow: hidden;
      z-index: 10;
    }

    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2rem 3rem;
      z-index: 100;
      position: relative;
    }

    .logo { font-family: 'Lora', serif; font-size: 1.1rem; font-weight: 600; text-decoration: none; color: var(--sumi); letter-spacing: 0.08em; }
    .nav-links { display: flex; gap: 2.5rem; }
    .nav-links a { font-size: 0.85rem; opacity: 0.6; text-decoration: none; transition: 0.3s; color: var(--sumi); }
    .nav-links a:hover { opacity: 1; }

    .hero-content { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
    .hero-title { font-family: 'Lora', serif; font-size: clamp(4rem, 10vw, 9rem); font-weight: 600; color: var(--sumi); position: absolute; top: 20%; left: 3rem; z-index: 50; pointer-events: none; }
    .hero-caption { font-size: 0.7rem; letter-spacing: 0.12em; text-transform: uppercase; opacity: 0.5; position: absolute; top: 15%; left: 3rem; z-index: 50; }
    .hero-tagline { font-family: 'Lora', serif; font-size: 1.15rem; font-style: italic; max-width: 26ch; opacity: 0.6; position: absolute; bottom: 15%; right: 3rem; text-align: right; z-index: 50; }

    .sphere-container { position: absolute; width: 600px; height: 600px; z-index: 20; pointer-events: none; display: flex; align-items: center; justify-content: center; }
    #sphereCanvas { width: 100%; height: 100%; }

    .scroll-spacer { height: 105vh; pointer-events: none; }

    .posts-section {
      min-height: 100vh;
      padding: 8rem 3rem;
      background: var(--bg);
      z-index: 100;
      position: relative;
    }

    .posts-container { max-width: 1400px; margin: 0 auto; }
    .section-label { font-size: 0.75rem; letter-spacing: 0.18em; text-transform: uppercase; opacity: 0.4; margin-bottom: 3rem; padding-bottom: 1rem; border-bottom: 1px solid var(--line); }

    .post-item {
      padding: 2.5rem 2rem;
      margin: 0 -2rem;
      border-bottom: 1px solid var(--line);
      cursor: pointer;
      transition: background 0.4s ease, padding-left 0.4s ease;
      border-radius: 4px;
      text-decoration: none;
      display: block;
    }

    .post-item:hover {
      background: var(--sumi);
      padding-left: 3rem;
    }

    .post-date { font-size: 0.8rem; opacity: 0.5; margin-bottom: 0.4rem; color: var(--text); transition: 0.4s; }
    .post-content h3 { font-family: 'Lora', serif; font-size: 2rem; font-weight: 500; line-height: 1.3; color: var(--sumi); transition: 0.4s; }

    .post-item:hover .post-date { color: var(--bg); opacity: 0.6; }
    .post-item:hover h3 { color: var(--bg); }

    footer { padding: 4rem 3rem; border-top: 1px solid var(--line); opacity: 0.4; font-size: 0.7rem; display: flex; justify-content: space-between; }

    @media (max-width: 768px) {
      .nav { padding: 1.5rem 1.5rem; }
      .hero-title { left: 1.5rem; }
      .hero-caption { left: 1.5rem; }
      .hero-tagline { right: 1.5rem; font-size: 1rem; }
      .sphere-container { width: 324px; height: 324px; }
      .posts-section { padding: 5rem 1.5rem; }
      .post-content h3 { font-size: 1.4rem; }
      .post-item { padding: 2rem 1.5rem; margin: 0 -1.5rem; }
      footer { padding: 3rem 1.5rem; flex-direction: column; gap: 0.5rem; }
    }
  </style>
</head>
<body>

  <section class="hero">
    <nav class="nav">
      <a href="/" class="logo">engawa</a>
      <div class="nav-links">
        <a href="#writing">Writing</a>
        <a href="/about">About</a>
      </div>
    </nav>
    <div class="hero-content">
      <p class="hero-caption" id="caption">In praise of friction</p>
      <h1 class="hero-title" id="title">engawa</h1>
      <div class="sphere-container" id="sphereContainer">
        <canvas id="sphereCanvas"></canvas>
      </div>
      <p class="hero-tagline" id="tagline">Where technology meets the grain of human things.</p>
    </div>
  </section>

  <div class="scroll-spacer"></div>

  <section class="posts-section" id="writing">
    <div class="posts-container">
      <div class="section-label">Writing</div>

      {/* üëá „Åì„Åì„Åã„ÇâËá™ÂãïÁîüÊàê„Ç≥„Éº„Éâ */}
      {sortedPosts.map(post => (
        <a href={`/writing/${post.slug}`} class="post-item">
          <div class="post-content">
            <p class="post-date">{post.data.pubDate}</p>
            <h3>{post.data.title}</h3>
          </div>
        </a>
      ))}
      {/* üëÜ „Åì„Åì„Åæ„Åß */}

    </div>
  </section>

  <footer>
    <div>engawa ¬∑ Taishi Okano</div>
    <div>¬© 2026 ¬∑ New York / Tokyo</div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <script is:inline>
    function startSphere() {
      const canvas = document.getElementById('sphereCanvas');
      if (!canvas || typeof THREE === 'undefined') return;

      const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(600, 600);

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(38, 1, 0.1, 100);
      camera.position.z = 4.2;

      const group = new THREE.Group();
      scene.add(group);

      const R = 1.2;
      const kakishibu = new THREE.Color('#D4976C');
      const kakishibuLight = new THREE.Color('#E0B090');

      // --- Geometry Logic ---
      const phi = (1 + Math.sqrt(5)) / 2;
      const icoV = [[-1,phi,0],[1,phi,0],[-1,-phi,0],[1,-phi,0],[0,-1,phi],[0,1,phi],[0,-1,-phi],[0,1,-phi],[phi,0,-1],[phi,0,1],[-phi,0,-1],[-phi,0,1]].map(v => new THREE.Vector3(...v).normalize());
      const icoF = [[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];

      function subdivide(verts, faces, n) {
        let v = verts.map(p => p.clone());
        let f = faces;
        for (let d = 0; d < n; d++) {
          const cache = {};
          const nf = [];
          function mid(a, b) {
            const k = Math.min(a,b) + ':' + Math.max(a,b);
            if (cache[k] !== undefined) return cache[k];
            v.push(new THREE.Vector3().addVectors(v[a], v[b]).normalize());
            cache[k] = v.length - 1;
            return cache[k];
          }
          for (const [a,b,c] of f) {
            const ab = mid(a,b), bc = mid(b,c), ca = mid(c,a);
            nf.push([a,ab,ca],[b,bc,ab],[c,ca,bc],[ab,bc,ca]);
          }
          f = nf;
        }
        return { v, f };
      }

      const mesh = subdivide(icoV, icoF, 3);
      const fCenters = mesh.f.map(([a,b,c]) => new THREE.Vector3().addVectors(mesh.v[a], mesh.v[b]).add(mesh.v[c]).multiplyScalar(1/3).normalize());
      const vertToFaces = {};
      mesh.f.forEach((face, fi) => { face.forEach(vi => { if (!vertToFaces[vi]) vertToFaces[vi] = []; vertToFaces[vi].push(fi); }); });

      function slerp(a, b, t) {
        const dot = Math.max(-1, Math.min(1, a.dot(b)));
        const omega = Math.acos(dot);
        if (omega < 1e-5) return a.clone().lerp(b, t).normalize();
        const so = Math.sin(omega);
        return a.clone().multiplyScalar(Math.sin((1-t)*omega)/so).add(b.clone().multiplyScalar(Math.sin(t*omega)/so)).normalize();
      }

      function arc(p1, p2, segs) {
        const pts = [];
        for (let i = 0; i <= segs; i++) pts.push(slerp(p1, p2, i/segs));
        return pts;
      }

      function makeLine(points, color, opacity) {
        const geom = new THREE.BufferGeometry().setFromPoints(points.map(p => p.clone().normalize().multiplyScalar(R)));
        return new THREE.Line(geom, new THREE.LineBasicMaterial({ color, transparent: true, opacity }));
      }

      function sortFacesAroundVertex(vi, faceIndices) {
        const vn = mesh.v[vi];
        let up = new THREE.Vector3(0, 1, 0);
        if (Math.abs(vn.dot(up)) > 0.99) up = new THREE.Vector3(1, 0, 0);
        const tx = new THREE.Vector3().crossVectors(vn, up).normalize();
        const ty = new THREE.Vector3().crossVectors(vn, tx).normalize();
        return faceIndices.sort((a, b) => {
          const ca = fCenters[a], cb = fCenters[b];
          return Math.atan2(ca.dot(ty), ca.dot(tx)) - Math.atan2(cb.dot(ty), cb.dot(tx));
        });
      }

      // Draw Cells
      Object.keys(vertToFaces).forEach(viStr => {
        const vi = parseInt(viStr), fIndices = vertToFaces[vi];
        if (!fIndices || fIndices.length < 5) return;
        const sorted = sortFacesAroundVertex(vi, [...fIndices]), n = sorted.length, cellCenter = mesh.v[vi].clone().normalize(), ring = sorted.map(fi => fCenters[fi].clone());
        for (let i = 0; i < n; i++) {
          const curr = ring[i], next = ring[(i + 1) % n], edgeMid = slerp(curr, next, 0.5);
          if (i % 2 === 0) {
            const indented = slerp(edgeMid, cellCenter, 0.28).normalize();
            group.add(makeLine([...arc(curr, indented, 4), ...arc(indented, next, 4).slice(1)], kakishibu, 0.5));
          } else {
            const bulged = slerp(edgeMid, cellCenter, -0.08).normalize();
            group.add(makeLine([...arc(curr, bulged, 4), ...arc(bulged, next, 4).slice(1)], kakishibu, 0.5));
          }
        }
        for (let i = 0; i < n; i += 2) {
          const indented = slerp(slerp(ring[i], ring[(i+1)%n], 0.5), cellCenter, 0.28).normalize();
          group.add(makeLine(arc(cellCenter, indented, 6), kakishibu, 0.45));
        }
      });

      // --- Friction & Scroll Logic ---
      let currentScrollP = 0;
      let targetScrollP = 0;
      const friction = 0.06;

      let floatX = 0, floatY = 0;
      const sc = document.getElementById('sphereContainer');
      const title = document.getElementById('title');
      const caption = document.getElementById('caption');
      const tagline = document.getElementById('tagline');

      function animate(time) {
        requestAnimationFrame(animate);

        currentScrollP += (targetScrollP - currentScrollP) * friction;

        group.rotation.y += 0.002;
        group.rotation.x += 0.0007;

        const t = time * 0.001;
        floatX = Math.sin(t * 0.23) * 24 + Math.sin(t * 0.37 + 1.2) * 16 + Math.sin(t * 0.71 + 3.7) * 8;
        floatY = Math.sin(t * 0.19 + 0.8) * 20 + Math.sin(t * 0.41 + 2.5) * 14 + Math.sin(t * 0.67 + 5.1) * 6;

        if (sc) {
          const scale = 1 + currentScrollP * 5;
          sc.style.transform = `translate(${floatX}px, ${floatY}px) scale(${scale})`;
          sc.style.opacity = Math.max(0, 1 - (currentScrollP * 1.5)).toString();
        }

        if (title) title.style.opacity = Math.max(0, 1 - currentScrollP * 2.5).toString();
        if (caption) caption.style.opacity = Math.max(0, 0.5 - currentScrollP * 2.5).toString();
        if (tagline) tagline.style.opacity = Math.max(0, 0.6 - currentScrollP * 2.5).toString();

        renderer.render(scene, camera);
      }
      animate(0);

      window.addEventListener('scroll', () => {
        targetScrollP = Math.min(window.scrollY / window.innerHeight, 1.2);
      });
    }

    // Initialize
    if (document.readyState === 'complete') {
      startSphere();
    } else {
      window.addEventListener('load', startSphere);
    }
  </script>
</body>
</html>